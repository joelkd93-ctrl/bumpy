<!DOCTYPE html>
<html lang="nb-NO">

<head>
  <meta charset="UTF-8">
  
  <!-- Primary Viewport -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no, maximum-scale=5">
  
  <!-- Primary Meta Tags -->
  <title>Bumpy ðŸ’— â€” Din Graviditetsreise</title>
  <meta name="title" content="Bumpy ðŸ’— â€” Din Graviditetsreise">
  <meta name="description" content="En kjÃ¦rlig fÃ¸lgesvenn for Andrine og Yoel gjennom svangerskapet. FÃ¸lg babyens utvikling, logg spark, og del Ã¸yeblikkene sammen.">
  <meta name="author" content="Yoel & Andrine">
  <meta name="keywords" content="graviditet, svangerskapsapp, babyspark, svangerskap, pregnancy tracker">
  
  <!-- PWA Core Meta Tags -->
  <meta name="theme-color" content="#FF4DA6">
  <meta name="color-scheme" content="light only">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="application-name" content="Bumpy">
  
  <!-- Apple/iOS Specific -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Bumpy">
  <meta name="apple-touch-fullscreen" content="yes">
  <link rel="apple-touch-icon" href="/icons/icon-180.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/icon-152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/icon-180.png">
  <link rel="apple-touch-icon" sizes="167x167" href="/icons/icon-167.png">`r`n  
  <!-- Windows/MS Tiles -->
  <meta name="msapplication-TileColor" content="#FF4DA6">
  <meta name="msapplication-TileImage" content="/icons/icon-144.png">
  <meta name="msapplication-config" content="/browserconfig.xml">
  
  <!-- Disable phone number detection -->
  <meta name="format-detection" content="telephone=no">
  
  <!-- Prevent text scaling on rotation -->
  <meta name="HandheldFriendly" content="True">
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://bumpy.app/">
  <meta property="og:title" content="Bumpy ðŸ’— â€” Din Graviditetsreise">
  <meta property="og:description" content="En kjÃ¦rlig fÃ¸lgesvenn for Andrine og Yoel gjennom svangerskapet.">
  <meta property="og:image" content="/icons/icon-512.png">
  <meta property="og:locale" content="nb_NO">
  
  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="https://bumpy.app/">
  <meta property="twitter:title" content="Bumpy ðŸ’— â€” Din Graviditetsreise">
  <meta property="twitter:description" content="En kjÃ¦rlig fÃ¸lgesvenn for Andrine og Yoel gjennom svangerskapet.">
  <meta property="twitter:image" content="/icons/icon-512.png">
  
  <!-- Manifest & Icons -->
  <link rel="manifest" href="/manifest.json" crossorigin="use-credentials">
  <link rel="icon" type="image/svg+xml" href="/icons/favicon.svg">`r`n`r`n`r`n<!-- Preconnect to external resources -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="dns-prefetch" href="https://bumpyapi.joelkd93.workers.dev">
  
  <!-- Premium Font: Plus Jakarta Sans -->
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  
  <!-- Critical CSS for instant first paint -->
  <style>
    /* Critical path CSS - inlined for performance */
    :root {
      --pink-50: #FDF0F5;
      --pink-100: #FFD1E6;
      --pink-500: #FF4DA6;
      --pink-600: #E63D90;
      --surface: #FFFFFF;
      --text-primary: #141414;
      --text-muted: #A8A8A8;
    }

    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
    }

    html {
      font-size: 16px;
      -webkit-text-size-adjust: 100%;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-rendering: optimizeLegibility;
      height: auto;
    }

    body {
      font-family: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(180deg, #FDF4F8 0%, #FFEDF5 60%, #FDF4F8 100%);
      margin: 0;
      min-height: 100dvh;
      color: #141414;
      overscroll-behavior-y: none;
      overflow-x: hidden;
    }

    #app {
      min-height: 100%;
      min-height: 100dvh;
      height: auto;
      display: flex;
      flex-direction: column;
      overflow: visible;
    }

    #modal-root {
      position: fixed;
      inset: 0;
      z-index: 9999;
      pointer-events: none;
    }

    #modal-root > * {
      pointer-events: auto;
    }

    /* Loading Screen */
    .loading-screen {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      min-height: 100dvh;
      background: linear-gradient(145deg, #FDF4F8 0%, #FFEDF5 50%, #FFF5F9 100%);
      padding: 24px;
      text-align: center;
    }

    .loading-icon {
      width: 80px;
      height: 80px;
      margin-bottom: 24px;
      animation: pulse 1.5s ease-in-out infinite;
    }

    .loading-heart {
      font-size: 64px;
      animation: heartbeat 1.5s ease-in-out infinite;
      filter: drop-shadow(0 4px 20px rgba(255, 77, 166, 0.3));
    }

    .loading-text {
      margin-top: 20px;
      font-size: 20px;
      font-weight: 600;
      color: var(--pink-500);
      letter-spacing: -0.02em;
    }

    .loading-subtitle {
      margin-top: 8px;
      font-size: 14px;
      color: var(--text-muted);
    }

    /* Loading progress bar */
    .loading-progress {
      width: 140px;
      height: 4px;
      background: var(--pink-100);
      border-radius: 999px;
      margin-top: 32px;
      overflow: hidden;
    }

    .loading-progress-bar {
      height: 100%;
      width: 30%;
      background: linear-gradient(90deg, var(--pink-500), var(--pink-600));
      border-radius: 999px;
      animation: loading 1.5s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.05); opacity: 0.9; }
    }

    @keyframes heartbeat {
      0%, 100% { transform: scale(1); }
      10% { transform: scale(1.15); }
      20% { transform: scale(1); }
      30% { transform: scale(1.1); }
      40% { transform: scale(1); }
    }

    @keyframes loading {
      0% { transform: translateX(-100%); }
      50% { transform: translateX(250%); }
      100% { transform: translateX(-100%); }
    }

    /* iOS safe areas */
    @supports (padding: max(0px)) {
      .loading-screen {
        padding-top: max(24px, env(safe-area-inset-top));
        padding-bottom: max(24px, env(safe-area-inset-bottom));
        padding-left: max(24px, env(safe-area-inset-left));
        padding-right: max(24px, env(safe-area-inset-right));
      }
    }

    /* PWA Install Banner - hidden initially */
    .install-banner {
      display: none;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--surface);
      padding: 16px 20px;
      padding-bottom: max(16px, env(safe-area-inset-bottom));
      box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
      z-index: 10000;
      animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    }

    .install-banner.show {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    @keyframes slideUp {
      from { transform: translateY(100%); }
      to { transform: translateY(0); }
    }

    /* Reduced motion support */
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }

    /* Dark mode critical CSS */
    @media (prefers-color-scheme: dark) {
      :root {
        --surface: #1C1819;
        --text-primary: #F5F0F2;
        --text-muted: #5F5457;
      }

      body {
        background: linear-gradient(180deg, #161314 0%, #1C1819 60%, #161314 100%);
      }

      .loading-screen {
        background: linear-gradient(145deg, #161314 0%, #1C1819 50%, #1F1A1B 100%);
      }
    }
  </style>
</head>

<body>
  <div id="app" class="app app-shell">
    <!-- Loading state shown until JS loads -->
    <div class="loading-screen" id="loading-screen">
      <div class="loading-heart">ðŸ’•</div>
      <p class="loading-text">Bumpy</p>
      <p class="loading-subtitle">Laster inn kjÃ¦rligheten...</p>
      <div class="loading-progress">
        <div class="loading-progress-bar"></div>
      </div>
    </div>
  </div>

  <!-- Dedicated modal portal root (outside app root, viewport anchored) -->
  <div id="modal-root"></div>

  <!-- PWA Install Banner (iOS) -->
  <div class="install-banner" id="install-banner">
    <span style="font-size: 32px;">ðŸ’•</span>
    <div style="flex: 1;">
      <strong style="display: block; font-size: 15px;">Installer Bumpy</strong>
      <span style="font-size: 13px; color: var(--text-muted);">Legg til pÃ¥ hjemmeskjermen</span>
    </div>
    <button id="install-btn" style="background: var(--pink-500); color: white; border: none; padding: 10px 20px; border-radius: 999px; font-weight: 600; font-size: 14px; cursor: pointer;">
      Installer
    </button>
    <button id="install-dismiss" style="background: none; border: none; font-size: 20px; padding: 8px; cursor: pointer; color: var(--text-muted);">
      âœ•
    </button>
  </div>

  <!-- Service Worker Registration & Install Prompt -->
  <script>
    // Register service worker as early as possible
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js', { scope: '/' })
          .then(reg => {
            console.log('ðŸ’• Bumpy: Offline mode enabled');
            
            // Check for updates
            reg.addEventListener('updatefound', () => {
              const newWorker = reg.installing;
              if (newWorker) {
                newWorker.addEventListener('statechange', () => {
                  if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                    // New version available - could show update prompt
                    console.log('ðŸ’• Bumpy: New version available');
                  }
                });
              }
            });
          })
          .catch(err => console.warn('SW registration failed:', err));
      });
    }

    // PWA Install Prompt
    let deferredPrompt;
    const installBanner = document.getElementById('install-banner');
    const installBtn = document.getElementById('install-btn');
    const installDismiss = document.getElementById('install-dismiss');

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      
      // Show install banner after a delay if not dismissed before
      if (!localStorage.getItem('bumpy-install-dismissed')) {
        setTimeout(() => {
          installBanner.classList.add('show');
        }, 5000);
      }
    });

    if (installBtn) {
      installBtn.addEventListener('click', async () => {
        if (deferredPrompt) {
          deferredPrompt.prompt();
          const { outcome } = await deferredPrompt.userChoice;
          console.log('Install prompt outcome:', outcome);
          deferredPrompt = null;
          installBanner.classList.remove('show');
        }
      });
    }

    if (installDismiss) {
      installDismiss.addEventListener('click', () => {
        installBanner.classList.remove('show');
        localStorage.setItem('bumpy-install-dismissed', 'true');
      });
    }

    // iOS install instruction detection
    const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
    const isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
    
    if (isIOS && !isStandalone && !localStorage.getItem('bumpy-ios-prompt-shown')) {
      // Could show iOS-specific install instructions
      console.log('ðŸ’• Bumpy: iOS device detected, not installed');
    }
  </script>

  <!-- Mobile Console for Debugging (eruda) -->
  <script src="https://cdn.jsdelivr.net/npm/eruda"></script>
  <script>
    // Only show console in development or when ?debug=1 is in URL
    if (window.location.search.includes('debug=1') || window.location.hostname === 'localhost') {
      eruda.init();
    }
  </script>

  <!-- Main app script -->
  <script type="module" src="/src/main.js"></script>
</body>

</html>

